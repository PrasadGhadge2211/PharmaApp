<!DOCTYPE html>
<html>
<head>
    <title>Invoice {{ sale._id }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/print.css') }}">
</head>
<body onload="window.print()">

    <!-- Store Letterhead -->
    <div class="store-name">Sanskar Medical</div>
    <div class="store-address">
        Shop No.35, Pratibha Sa, Ghadge Nagar, Nashik Road, Nashik<br>
        Phone: 94229 90414 / 80070 74991<br>
        DL.NO: 20-433500 / 21-433501<br>
        <!-- GSTIN: -->
    </div>

    <!-- Customer and Invoice Details -->
    <div class="row mb-4 invoice-to">
        <div class="col-sm-6">
            <h5 class="mb-3 text-primary">To:</h5>
            {% if sale.customer_name %}
                <address>
                    <strong>{{ sale.customer_name }}</strong><br>
                    {% if sale.customer_address %}
                        {{ sale.customer_address|replace('\n', '<br>')|safe }}<br>
                    {% endif %}
                    {% if sale.customer_phone %}Phone: {{ sale.customer_phone }}{% endif %}
                    {% if not sale.customer_address and not sale.customer_phone %}
                        (No further details)
                    {% endif %}
                </address>
            {% else %}
                <address>
                    <strong>Walk-in Customer</strong>
                </address>
            {% endif %}
        </div>
        <div class="col-sm-6 text-sm-end">
            <h5 class="mb-3 text-primary">Invoice Details:</h5>
            <strong>Invoice ID:</strong> {{ sale._id }}<br>
            <p><strong>Date:</strong>
                {% if sale.date %}
                    {{ sale.date.strftime("%Y-%m-%d") }}
                {% else %}
                    N/A
                {% endif %}
            </p>
            <h5 class="mb-3 text-primary">Payment Method:</h5>
            {{ sale.payment_method or 'N/A' }}
        </div>
    </div>

    <!-- Items table -->
    <div class="table-responsive mb-4">
        <table class="table table-striped table-hover">
            <thead class="table-light">
                <tr>
                    <th class="text-center" style="width: 5%;">#</th>
                    <th>Medicine</th>
                    <th>Batch Number</th>
                    <th class="text-center">Quantity</th>
                    <th class="text-end">Price (₹)</th>
                    <th class="text-end">Total (₹)</th>
                </tr>
            </thead>
            <tbody>
                {% for item in items %}
                <tr>
                    <td class="text-center">{{ loop.index }}</td>
                    <td>{{ item.medicine_name }}</td>
                    <td>{{ item.batch_number or '-' }}</td>
                    <td class="text-center">{{ item.quantity }}</td>
                    <td class="text-end">
                        {{ "%.2f"|format(item.ps) }}/ps | 
                        {{ "%.2f"|format(item.pu) }}/pu
                    </td>
                    <td class="text-end">{{ "%.2f"|format(item.total) }}</td>
                </tr>
                {% else %}
                <tr>
                    <td colspan="6" class="text-center text-muted fst-italic">
                        No items found for this invoice.
                    </td>
                </tr>
                {% endfor %}
            </tbody>

            {% if items %}
            <tfoot>
                <tr>
                    <td colspan="5" class="text-end border-0"><strong>Subtotal:</strong></td>
                    <td class="text-end border-0">
                        ₹{{ "%.2f"|format(sale.total_amount + (sale.discount or 0)) }}
                    </td>
                </tr>
                <tr>
                    <td colspan="5" class="text-end border-0"><strong>Discount:</strong></td>
                    <td class="text-end border-0">
                        ₹{{ "%.2f"|format(sale.discount or 0) }}
                    </td>
                </tr>
                <tr class="fw-bold table-light">
                    <td colspan="5" class="text-end border-0"><strong>Total Amount:</strong></td>
                    <td class="text-end border-0 fs-5">
                        ₹{{ "%.2f"|format(sale.total_amount) }}
                    </td>
                </tr>
            </tfoot>
            {% endif %}
        </table>
    </div>

    <!-- Thank you -->
    <div class="text-center text-muted mt-4">
        <p><small>Thank you for your business!</small></p>
    </div>

</body>
</html>
